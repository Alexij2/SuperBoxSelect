/*!
 * SuperBoxSelect - Advanced Listbox/Resource List Template Variable Type
 * Version: 2.3.0
 * Build date: 2019-02-17
 */

!function(e){"use strict";"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&void 0!==module.exports?module.exports=e():window.Sortable=e()}(function(){"use strict";if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var U,j,G,u,K,Z,p,M,I,O,Q,n,J,$,a,s,c,h,N,ee,te,oe,ne,ie,re,P=[],le=!1,f=!1,ae=!1,d=[],se=!1,ce=!1,i=/\s+/g,de="Sortable"+(new Date).getTime(),pe=window,ue=pe.document,g=pe.parseInt,he=pe.setTimeout,t=pe.jQuery||pe.Zepto,o=pe.Polymer,r={capture:!1,passive:!1},fe=!!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie|iemobile)/i),m=!!navigator.userAgent.match(/Edge/i),v=m||fe?"cssFloat":"float",l="draggable"in ue.createElement("div"),b=function(){if(fe)return!1;var e=ue.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}(),ge=!1,x=!1,me=Math.abs,_=Math.min,y=[],S=function(e,t){var o=X(e),n=g(o.width),i=R(e,0,t),r=R(e,1,t),l=i&&X(i),a=r&&X(r),s=l&&g(l.marginLeft)+g(l.marginRight)+Ie(i).width,c=a&&g(a.marginLeft)+g(a.marginRight)+Ie(r).width;if("flex"===o.display)return"column"===o.flexDirection||"column-reverse"===o.flexDirection?"vertical":"horizontal";if(i&&"none"!==l.float){var d="left"===l.float?"left":"right";return!r||"both"!==a.clear&&a.clear!==d?"horizontal":"vertical"}return i&&("block"===l.display||"flex"===l.display||"table"===l.display||"grid"===l.display||n<=s&&"none"===o[v]||r&&"none"===o[v]&&n<s+c)?"vertical":"horizontal"},ve=function(e,t){if(!e||!e.getBoundingClientRect)return pe;var o=e,n=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var i=X(o);if(o.clientWidth<o.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!o||!o.getBoundingClientRect||o===ue.body)return pe;if(n||t)return o;n=!0}}}while(o=o.parentNode);return pe},w=W(function(o,e,t,n){if(e.scroll){var i=t?t[de]:window,r=e.scrollSensitivity,l=e.scrollSpeed,a=o.clientX,s=o.clientY,c=(window.innerWidth,window.innerHeight,!1);I!==t&&(H(),M=e.scroll,O=e.scrollFn,!0===M&&(M=ve(t,!0),I=M));var d=0,p=M;do{var u,h,f,g,m,v,b,x,_,y=p,S=Ie(y),w=S.top,D=S.bottom,T=S.left,E=S.right,C=S.width,B=S.height;if(_=y!==pe?(u=y.scrollWidth,h=y.scrollHeight,f=X(y),v=C<u&&("auto"===f.overflowX||"scroll"===f.overflowX),b=B<h&&("auto"===f.overflowY||"scroll"===f.overflowY),x=y.scrollLeft,y.scrollTop):(u=ue.documentElement.scrollWidth,h=ue.documentElement.scrollHeight,f=X(ue.documentElement),v=C<u&&("auto"===f.overflowX||"scroll"===f.overflowX||"visible"===f.overflowX),b=B<h&&("auto"===f.overflowY||"scroll"===f.overflowY||"visible"===f.overflowY),x=ue.documentElement.scrollLeft,ue.documentElement.scrollTop),g=v&&(me(E-a)<=r&&x+C<u)-(me(T-a)<=r&&!!x),m=b&&(me(D-s)<=r&&_+B<h)-(me(w-s)<=r&&!!_),!P[d])for(var k=0;k<=d;k++)P[k]||(P[k]={});P[d].vx==g&&P[d].vy==m&&P[d].el===y||(P[d].el=y,P[d].vx=g,P[d].vy=m,clearInterval(P[d].pid),!y||0==g&&0==m||(c=!0,P[d].pid=setInterval(function(){n&&0===this.layer&&_e.active._emulateDragOver(!0);var e=P[this.layer].vy?P[this.layer].vy*l:0,t=P[this.layer].vx?P[this.layer].vx*l:0;"function"==typeof O&&"continue"!==O.call(i,t,e,o,N,P[this.layer].el)||(P[this.layer].el===pe?pe.scrollTo(pe.pageXOffset+t,pe.pageYOffset+e):(P[this.layer].el.scrollTop+=e,P[this.layer].el.scrollLeft+=t))}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&p!==pe&&(p=ve(p,!1)));le=c}},30),H=function(){P.forEach(function(e){clearInterval(e.pid)}),P=[]},D=function(e){function s(l,a){return function(e,t,o,n){var i=e.options.group.name&&t.options.group.name&&e.options.group.name===t.options.group.name;if(null==l&&(a||i))return!0;if(null==l||!1===l)return!1;if(a&&"clone"===l)return l;if("function"==typeof l)return s(l(e,t,o,n),a)(e,t,o,n);var r=(a?e:t).options.group.name;return!0===l||"string"==typeof l&&l===r||l.join&&-1<l.indexOf(r)}}var t={},o=e.group;o&&"object"==typeof o||(o={name:o}),t.name=o.name,t.checkPull=s(o.pull,!0),t.checkPut=s(o.put),t.revertClone=o.revertClone,e.group=t},T=function(e){U&&U.parentNode&&U.parentNode[de]&&U.parentNode[de]._computeIsAligned(e)},be=function(e,t){for(var o=t;!o[de];)o=o.parentNode;return e===o},xe=function(e,t,o){for(var n=e.parentNode;n&&!n[de];)n=n.parentNode;n&&n[de][o](q(t,{artificialBubble:!0}))},E=function(){!b&&G&&X(G,"display","none")},C=function(){!b&&G&&X(G,"display","")};ue.addEventListener("click",function(e){if(ae)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),ae=!1},!0);var B,e=function(e){if(e=e.touches?e.touches[0]:e,U){var t=function(e,t){for(var o=0;o<d.length;o++)if(!d[o].children.length){var n=Ie(d[o]),i=d[o][de].options.emptyInsertThreshold,r=e>=n.left-i&&e<=n.right+i,l=t>=n.top-i&&t<=n.bottom+i;if(r&&l)return d[o]}}(e.clientX,e.clientY);t&&t[de]._onDragOver({clientX:e.clientX,clientY:e.clientY,target:t,rootEl:t})}};function _e(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, not "+{}.toString.call(e);this.el=e,this.options=t=q({},t),e[de]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0,draggable:/[uo]l/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return S(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,touchStartThreshold:g(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==_e.supportPointer&&("PointerEvent"in window||window.navigator&&"msPointerEnabled"in window.navigator),emptyInsertThreshold:5};for(var n in o)!(n in t)&&(t[n]=o[n]);for(var i in D(t),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=!t.forceFallback&&l,t.supportPointer?k(e,"pointerdown",this._onTapStart):(k(e,"mousedown",this._onTapStart),k(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(k(e,"dragover",this),k(e,"dragenter",this)),d.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[])}function ye(e,t,o,n){if(e){o=o||ue;do{if(null!=t&&(">"===t[0]&&e.parentNode===o&&z(e,t.substring(1))||z(e,t))||n&&e===o)return e;if(e===o)break}while(e=(i=e).host&&i!==ue&&i.host.nodeType?i.host:i.parentNode)}var i;return null}function k(e,t,o){e.addEventListener(t,o,r)}function A(e,t,o){e.removeEventListener(t,o,r)}function Se(e,t,o){if(e&&t)if(e.classList)e.classList[o?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(i," ").replace(" "+t+" "," ");e.className=(n+(o?" "+t:"")).replace(i," ")}}function X(e,t,o){var n=e&&e.style;if(n){if(void 0===o)return ue.defaultView&&ue.defaultView.getComputedStyle?o=ue.defaultView.getComputedStyle(e,""):e.currentStyle&&(o=e.currentStyle),void 0===t?o:o[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=o+("string"==typeof o?"":"px")}}function Y(e){var t="";do{var o=X(e,"transform");o&&"none"!==o&&(t=o+" "+t)}while(e=e.parentNode);return window.DOMMatrix?new DOMMatrix(t):window.WebKitCSSMatrix?new WebKitCSSMatrix(t):window.CSSMatrix?new CSSMatrix(t):void 0}function L(e,t,o){if(e){var n=e.getElementsByTagName(t),i=0,r=n.length;if(o)for(;i<r;i++)o(n[i],i);return n}return[]}function we(e,t,o,n,i,r,l,a,s){var c,d=(e=e||t[de]).options,p="on"+o.charAt(0).toUpperCase()+o.substr(1);!window.CustomEvent||fe||m?(c=ue.createEvent("Event")).initEvent(o,!0,!0):c=new CustomEvent(o,{bubbles:!0,cancelable:!0}),c.to=i||t,c.from=r||t,c.item=n||t,c.clone=u,c.oldIndex=l,c.newIndex=a,c.originalEvent=s,t&&t.dispatchEvent(c),d[p]&&d[p].call(e,c)}function De(e,t,o,n,i,r,l,a){var s,c,d=e[de],p=d.options.onMove;return!window.CustomEvent||fe||m?(s=ue.createEvent("Event")).initEvent("move",!0,!0):s=new CustomEvent("move",{bubbles:!0,cancelable:!0}),s.to=t,s.from=e,s.dragged=o,s.draggedRect=n,s.related=i||t,s.relatedRect=r||Ie(t),s.willInsertAfter=a,s.originalEvent=l,e.dispatchEvent(s),p&&(c=p.call(d,s,l)),c}function F(e){e.draggable=!1}function Te(){ge=!1}function R(e,t,o){for(var n=0,i=0,r=e.children;i<r.length;){if("none"!==r[i].style.display&&r[i]!==G&&r[i]!==U&&ye(r[i],o.draggable,e,!1)){if(n===t)return r[i];n++}i++}return null}function Ee(e){for(var t=e.lastElementChild;(t===G||"none"===t.style.display)&&(t=t.previousElementSibling););return t||null}function V(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,o=t.length,n=0;o--;)n+=t.charCodeAt(o);return n.toString(36)}function Ce(e,t){var o=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&e!==u&&o++;return o}function z(e,t){if(e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}function W(o,n){return function(){if(!B){var e=arguments,t=this;B=he(function(){1===e.length?o.call(t,e[0]):o.apply(t,e),B=void 0},n)}}}function q(e,t){if(e&&t)for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e}function Be(e){return o&&o.dom?o.dom(e).cloneNode(!0):t?t(e).clone(!0)[0]:e.cloneNode(!0)}function ke(e){return he(e,0)}function Me(e){return clearTimeout(e)}function Ie(e,t,o){if(e.getBoundingClientRect||e===pe){var n,i,r,l,a,s,c;if(c=e!==pe?(i=(n=e.getBoundingClientRect()).top,r=n.left,l=n.bottom,a=n.right,s=n.height,n.width):(r=i=0,l=window.innerHeight,a=window.innerWidth,s=window.innerHeight,window.innerWidth),o&&e!==pe){if(t=t||e.parentNode,!fe)do{if(t&&t.getBoundingClientRect&&"none"!==X(t,"transform")){var d=t.getBoundingClientRect();i-=d.top+g(X(t,"border-top-width")),r-=d.left+g(X(t,"border-left-width")),l=i+n.height,a=r+n.width;break}}while(t=t.parentNode);var p=Y(e),u=p&&p.a,h=p&&p.d;p&&(l=(i/=h)+(s/=h),a=(r/=u)+(c/=u))}return{top:i,left:r,bottom:l,right:a,width:c,height:s}}}return k(ue,"dragover",e),k(ue,"mousemove",e),k(ue,"touchmove",e),_e.prototype={constructor:_e,_computeIsAligned:function(e){var t;if(G&&!b?(E(),t=ue.elementFromPoint(e.clientX,e.clientY),C()):t=e.target,t=ye(t,this.options.draggable,this.el,!1),!x&&U&&U.parentNode===this.el){for(var o,n,i,r,l,a,s,c,d=this.el.children,p=0;p<d.length;p++)ye(d[p],this.options.draggable,this.el,!1)&&d[p]!==t&&(d[p].sortableMouseAligned=(o=e.clientX,n=e.clientY,i=d[p],r=this._getDirection(e,null),this.options,void 0,l=Ie(i),a="vertical"===r?l.left:l.top,s="vertical"===r?l.right:l.bottom,a<(c="vertical"===r?o:n)&&c<s));ye(t,this.options.draggable,this.el,!0)||(te=null),x=!0,he(function(){x=!1},30)}},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,U):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t,o=this,n=this.el,i=this.options,r=i.preventOnFilter,l=e.type,a=e.touches&&e.touches[0],s=(a||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||s,d=i.filter;if(function(e){y.length=0;var t=e.getElementsByTagName("input"),o=t.length;for(;o--;){var n=t[o];n.checked&&y.push(n)}}(n),(!fe||e.artificialBubble||be(n,s))&&!U&&!(/mousedown|pointerdown/.test(l)&&0!==e.button||i.disabled||c.isContentEditable))if(s=ye(s,i.draggable,n,!1)){if(p!==s){if(t=Ce(s,i.draggable),"function"==typeof d){if(d.call(this,e,s,this))return we(o,c,"filter",s,n,n,t),void(r&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some(function(e){if(e=ye(c,e.trim(),n,!1))return we(o,e,"filter",s,n,n,t),!0})))return void(r&&e.cancelable&&e.preventDefault());i.handle&&!ye(c,i.handle,n,!1)||this._prepareDragStart(e,a,s,t)}}else fe&&xe(n,e,"_onTapStart")}},_handleAutoScroll:function(t,o){if(U&&this.options.scroll){var n=t.clientX,i=t.clientY,e=ue.elementFromPoint(n,i),r=this;if(o||m||fe){w(t,r.options,e,o);var l=ve(e,!0);!le||a&&n===s&&i===c||(a&&clearInterval(a),a=setInterval(function(){if(U){var e=ve(ue.elementFromPoint(n,i),!0);e!==l&&(l=e,H(),w(t,r.options,l,o))}},10),s=n,c=i)}else{if(!r.options.bubbleScroll||ve(e,!0)===window)return void H();w(t,r.options,ve(e,!1),!1)}}},_prepareDragStart:function(e,t,o,n){var i,r=this,l=r.el,a=r.options,s=l.ownerDocument;o&&!U&&o.parentNode===l&&(K=l,j=(U=o).parentNode,Z=U.nextSibling,p=o,J=a.group,Q=n,h={target:U,clientX:(t||e).clientX,clientY:(t||e).clientY},this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,U.style["will-change"]="all",U.style.transition="",U.style.transform="",i=function(){r._disableDelayedDrag(),U.draggable=r.nativeDraggable,r._triggerDragStart(e,t),we(r,K,"choose",U,K,K,Q),Se(U,a.chosenClass,!0)},a.ignore.split(",").forEach(function(e){L(U,e.trim(),F)}),a.supportPointer?k(s,"pointerup",r._onDrop):(k(s,"mouseup",r._onDrop),k(s,"touchend",r._onDrop),k(s,"touchcancel",r._onDrop)),a.delay?(k(s,"mouseup",r._disableDelayedDrag),k(s,"touchend",r._disableDelayedDrag),k(s,"touchcancel",r._disableDelayedDrag),k(s,"mousemove",r._delayedDragTouchMoveHandler),k(s,"touchmove",r._delayedDragTouchMoveHandler),a.supportPointer&&k(s,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=he(i,a.delay)):i())},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;_(me(t.clientX-this._lastX),me(t.clientY-this._lastY))>=this.options.touchStartThreshold&&this._disableDelayedDrag()},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),A(e,"mouseup",this._disableDelayedDrag),A(e,"touchend",this._disableDelayedDrag),A(e,"touchcancel",this._disableDelayedDrag),A(e,"mousemove",this._delayedDragTouchMoveHandler),A(e,"touchmove",this._delayedDragTouchMoveHandler),A(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||("touch"==e.pointerType?e:null),!this.nativeDraggable||t?this.options.supportPointer?k(ue,"pointermove",this._onTouchMove):k(ue,t?"touchmove":"mousemove",this._onTouchMove):(k(U,"dragend",this),k(K,"dragstart",this._onDragStart));try{ue.selection?ke(function(){ue.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e){if(f=!1,K&&U){this.nativeDraggable&&(k(ue,"dragover",this._handleAutoScroll),k(ue,"dragover",T));var t=this.options;!e&&Se(U,t.dragClass,!1),Se(U,t.ghostClass,!0),X(U,"transform",""),_e.active=this,e&&this._appendGhost(),we(this,K,"start",U,K,K,Q)}else this._nulling()},_emulateDragOver:function(e){if(N){if(this._lastX===N.clientX&&this._lastY===N.clientY&&!e)return;this._lastX=N.clientX,this._lastY=N.clientY,E();for(var t=ue.elementFromPoint(N.clientX,N.clientY),o=t;t&&t.shadowRoot;)o=t=t.shadowRoot.elementFromPoint(N.clientX,N.clientY);if(o)do{if(o[de])if(o[de]._onDragOver({clientX:N.clientX,clientY:N.clientY,target:t,rootEl:o})&&!this.options.dragoverBubble)break;t=o}while(o=o.parentNode);U.parentNode[de]._computeIsAligned(N),C()}},_onTouchMove:function(e){if(h){var t=this.options,o=t.fallbackTolerance,n=t.fallbackOffset,i=e.touches?e.touches[0]:e,r=G&&Y(G),l=G&&r&&r.a,a=G&&r&&r.d,s=(i.clientX-h.clientX+n.x)/(l||1),c=(i.clientY-h.clientY+n.y)/(a||1),d=e.touches?"translate3d("+s+"px,"+c+"px,0)":"translate("+s+"px,"+c+"px)";if(!_e.active&&!f){if(o&&_(me(i.clientX-this._lastX),me(i.clientY-this._lastY))<o)return;this._onDragStart(e,!0)}this._handleAutoScroll(i,!0),ee=!0,N=i,X(G,"webkitTransform",d),X(G,"mozTransform",d),X(G,"msTransform",d),X(G,"transform",d),e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!G){var e=Ie(U,this.options.fallbackOnBody?ue.body:K,!0),t=(X(U),this.options);Se(G=U.cloneNode(!0),t.ghostClass,!1),Se(G,t.fallbackClass,!0),Se(G,t.dragClass,!0),X(G,"box-sizing","border-box"),X(G,"margin",0),X(G,"top",e.top),X(G,"left",e.left),X(G,"width",e.width),X(G,"height",e.height),X(G,"opacity","0.8"),X(G,"position","fixed"),X(G,"zIndex","100000"),X(G,"pointerEvents","none"),t.fallbackOnBody&&ue.body.appendChild(G)||K.appendChild(G)}},_onDragStart:function(e,t){var o=this,n=e.dataTransfer,i=o.options;(u=Be(U)).draggable=!1,u.style["will-change"]="",this._hideClone(),Se(u,o.options.chosenClass,!1),o._cloneId=ke(function(){o.options.removeCloneOnHide||K.insertBefore(u,U),we(o,K,"clone",U)}),!t&&Se(U,i.dragClass,!0),t?(ae=!0,o._loopId=setInterval(o._emulateDragOver,50)):(A(ue,"mouseup",o._onDrop),A(ue,"touchend",o._onDrop),A(ue,"touchcancel",o._onDrop),n&&(n.effectAllowed="move",i.setData&&i.setData.call(o,n,U)),k(ue,"drop",o),X(U,"transform","translateZ(0)")),f=!0,o._dragStartId=ke(o._dragStarted.bind(o,t)),k(ue,"selectstart",o)},_onDragOver:function(e){var t,o,n,i=this.el,r=e.target,l=this.options,a=l.group,s=_e.active,c=J===a,d=l.sort,p=this;if(!ge&&(!fe||e.rootEl||e.artificialBubble||be(i,r))){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),ee=!0,r=ye(r,l.draggable,i,!0),ye(e.target,null,U,!0)||r.animated)return W();if(r!==U&&(ae=!1),s&&!l.disabled&&(c?d||(n=!K.contains(U)):$===this||(this.lastPutMode=J.checkPull(this,s,U,e))&&a.checkPut(this,s,U,e))){var u=this._getDirection(e,r);if(t=Ie(U),n)return this._hideClone(),j=K,Z?K.insertBefore(U,Z):K.appendChild(U),W();if(0===i.children.length||i.children[0]===G||(A=e,X=u,Y=Ie(Ee(i)),L="vertical"===X?A.clientY:A.clientX,F="vertical"===X?A.clientX:A.clientY,R="vertical"===X?Y.bottom:Y.right,V="vertical"===X?Y.left:Y.top,z="vertical"===X?Y.right:Y.bottom,("vertical"===X?z+10<F||F<=z&&R<L&&V<=F:R<L&&V<F||L<=R&&z+10<F)&&!U.animated)){if(0!==i.children.length&&i.children[0]!==G&&i===e.target&&(r=Ee(i)),r&&(o=Ie(r)),c?s._hideClone():s._showClone(this),!1!==De(K,i,U,t,r,o,e,!!r))return i.appendChild(U),j=i,re=null,q(),this._animate(t,U),r&&this._animate(o,r),W()}else if(r&&r!==U&&r.parentNode===i){var h,f=0,g=r.sortableMouseAligned,m=U.parentNode!==i,v=function(e,t){var o=ve(o,!0),n=Ie(e)[t];for(;o;){var i=Ie(o)[t];if(!("top"===t||"left"===t?i<=n:n<=i))return!0;if(o===pe)break;o=ve(o,!1)}return!1}(r,"vertical"===u?"top":"left");if(te!==r&&(ne=null,h=Ie(r)["vertical"===u?"top":"left"],se=!1),E=r,C=u,B=(T=U)===U&&re||Ie(T),k=E===U&&re||Ie(E),M="vertical"===C?B.left:B.top,I="vertical"===C?B.right:B.bottom,O="vertical"===C?B.width:B.height,N="vertical"===C?k.left:k.top,P="vertical"===C?k.right:k.bottom,H="vertical"===C?k.width:k.height,ne=(M===N||I===P||M+O/2===N+H/2)&&g||m||v||l.invertSwap||"insert"===ne||"swap"===ne?("swap"!==ne&&(ce=l.invertSwap||m||le||v),f=function(e,t,o,n,i,r,l){var a=Ie(t),s="vertical"===o?e.clientY:e.clientX,c="vertical"===o?a.height:a.width,d="vertical"===o?a.top:a.left,p="vertical"===o?a.bottom:a.right,u=Ie(U),h=!1;if(!r)if(l&&ie<c*n)if(!se&&(1===oe?d+c*i/2<s:s<p-c*i/2)&&(se=!0),se)h=!0;else{"vertical"===o?u.top:u.left,"vertical"===o?u.bottom:u.right;if(1===oe?s<d+ie:p-ie<s)return-1*oe}else if(d+c*(1-n)/2<s&&s<p-c*(1-n)/2)return d+c/2<s?-1:1;if((h=h||r)&&(s<d+c*i/2||p-c*i/2<s))return d+c/2<s?1:-1;return 0}(e,r,u,l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,ce,te===r),"swap"):(y=r,w=Ce(U,(S=l).draggable),D=Ce(y,S.draggable),f=w<D?1:-1,"insert"),0===f)return W();re=null,oe=f,o=Ie(te=r);var b=r.nextElementSibling,x=!1,_=De(K,i,U,t,r,o,e,x=1===f);if(!1!==_)return 1!==_&&-1!==_||(x=1===_),ge=!0,he(Te,30),c?s._hideClone():s._showClone(this),x&&!b?i.appendChild(U):r.parentNode.insertBefore(U,x?b:r),j=U.parentNode,void 0===h||ce||(ie=me(h-Ie(r)["vertical"===u?"top":"left"])),q(),!m&&this._animate(o,r),this._animate(t,U),W()}if(i.contains(U))return W()}var y,S,w,D,T,E,C,B,k,M,I,O,N,P,H,A,X,Y,L,F,R,V,z;return fe&&!e.rootEl&&xe(i,e,"_onDragOver"),!1}function W(){return s&&(Se(U,$?$.options.ghostClass:s.options.ghostClass,!1),Se(U,l.ghostClass,!0)),$!==p&&p!==_e.active?$=p:p===_e.active&&($=null),(r===U&&!U.animated||r===i&&!r.animated)&&(te=null),l.dragoverBubble||e.rootEl||r===ue||(p._handleAutoScroll(e),U.parentNode[de]._computeIsAligned(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),!0}function q(){we(p,K,"change",r,i,K,Q,Ce(U,l.draggable),e)}},_animate:function(e,t){var o=this.options.animation;if(o){var n=Ie(t);if(t===U&&(re=n),1===e.nodeType&&(e=Ie(e)),e.left+e.width/2!==n.left+n.width/2||e.top+e.height/2!==n.top+n.height/2){var i=Y(this.el),r=i&&i.a,l=i&&i.d;X(t,"transition","none"),X(t,"transform","translate3d("+(e.left-n.left)/(r||1)+"px,"+(e.top-n.top)/(l||1)+"px,0)"),t.offsetWidth,X(t,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),X(t,"transform","translate3d(0,0,0)")}"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=he(function(){X(t,"transition",""),X(t,"transform",""),t.animated=!1},o)}},_offUpEvents:function(){var e=this.el.ownerDocument;A(ue,"touchmove",this._onTouchMove),A(ue,"pointermove",this._onTouchMove),A(e,"mouseup",this._onDrop),A(e,"touchend",this._onDrop),A(e,"pointerup",this._onDrop),A(e,"touchcancel",this._onDrop),A(ue,"selectstart",this)},_onDrop:function(e){var t=this.el,o=this.options;se=ce=le=f=!1,clearInterval(this._loopId),clearInterval(a),H(),clearTimeout(B),B=void 0,clearTimeout(this._dragStartTimer),Me(this._cloneId),Me(this._dragStartId),A(ue,"mousemove",this._onTouchMove),this.nativeDraggable&&(A(ue,"drop",this),A(t,"dragstart",this._onDragStart),A(ue,"dragover",this._handleAutoScroll),A(ue,"dragover",T)),this._offUpEvents(),e&&(ee&&(e.cancelable&&e.preventDefault(),!o.dropBubble&&e.stopPropagation()),G&&G.parentNode&&G.parentNode.removeChild(G),(K===j||$&&"clone"!==$.lastPutMode)&&u&&u.parentNode&&u.parentNode.removeChild(u),U&&(this.nativeDraggable&&A(U,"dragend",this),F(U),U.style["will-change"]="",Se(U,$?$.options.ghostClass:this.options.ghostClass,!1),Se(U,this.options.chosenClass,!1),we(this,K,"unchoose",U,j,K,Q,null,e),K!==j?(0<=(n=Ce(U,o.draggable))&&(we(null,j,"add",U,j,K,Q,n,e),we(this,K,"remove",U,j,K,Q,n,e),we(null,j,"sort",U,j,K,Q,n,e),we(this,K,"sort",U,j,K,Q,n,e)),$&&$.save()):U.nextSibling!==Z&&0<=(n=Ce(U,o.draggable))&&(we(this,K,"update",U,j,K,Q,n,e),we(this,K,"sort",U,j,K,Q,n,e)),_e.active&&(null!=n&&-1!==n||(n=Q),we(this,K,"end",U,j,K,Q,n,e),this.save()))),this._nulling()},_nulling:function(){K=U=j=G=Z=u=p=M=I=P.length=a=s=c=h=N=ee=n=Q=te=oe=re=$=J=_e.active=null,y.forEach(function(e){e.checked=!0}),y.length=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":U&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],o=this.el.children,n=0,i=o.length,r=this.options;n<i;n++)ye(e=o[n],r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||V(e));return t},sort:function(e){var n={},i=this.el;this.toArray().forEach(function(e,t){var o=i.children[t];ye(o,this.options.draggable,i,!1)&&(n[e]=o)},this),e.forEach(function(e){n[e]&&(i.removeChild(n[e]),i.appendChild(n[e]))})},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ye(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var o=this.options;if(void 0===t)return o[e];o[e]=t,"group"===e&&D(o)},destroy:function(){var e=this.el;e[de]=null,A(e,"mousedown",this._onTapStart),A(e,"touchstart",this._onTapStart),A(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(A(e,"dragover",this),A(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),d.splice(d.indexOf(this.el),1),this.el=e=null},_hideClone:function(){u.cloneHidden||(X(u,"display","none"),u.cloneHidden=!0,u.parentNode&&this.options.removeCloneOnHide&&u.parentNode.removeChild(u))},_showClone:function(e){"clone"===e.lastPutMode?u.cloneHidden&&(K.contains(U)&&!this.options.group.revertClone?K.insertBefore(u,U):Z?K.insertBefore(u,Z):K.appendChild(u),this.options.group.revertClone&&this._animate(U,u),X(u,"display",""),u.cloneHidden=!1):this._hideClone()}},k(ue,"touchmove",function(e){(_e.active||f)&&e.cancelable&&e.preventDefault()}),_e.utils={on:k,off:A,css:X,find:L,is:function(e,t){return!!ye(e,t,e,!1)},extend:q,throttle:W,closest:ye,toggleClass:Se,clone:Be,index:Ce,nextTick:ke,cancelNextTick:Me,detectDirection:S,getChild:R},_e.create=function(e,t){return new _e(e,t)},_e.version="1.8.3",_e});var SuperBoxSelectTV=function(e){e=e||{},SuperBoxSelectTV.superclass.constructor.call(this,e)};Ext.extend(SuperBoxSelectTV,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},jquery:{},form:{}}),Ext.reg("superboxselecttv",SuperBoxSelectTV);var SuperBoxSelect=new SuperBoxSelectTV;SuperBoxSelect.panel.InputOptions=function(e){e=e||{},this.options=e.options,this.params=e.params,Ext.applyIf(e,{layout:"form",autoHeight:!0,cls:"form-with-labels",labelAlign:"top",border:!1,items:[{xtype:"modx-combo",fieldLabel:_("superboxselect.selectType"),description:MODx.expandHelp?"":_("superboxselect.selectType_desc"),name:"inopt_selectType",hiddenName:"inopt_selectType",id:"inopt_selectType",value:this.params.selectType||"resources",anchor:"100%",url:SuperBoxSelect.config.connectorUrl,baseParams:{action:"mgr/selecttypes/getlist",tvId:MODx.request.id,package:this.params.selectPackage||""},listeners:{select:{fn:this.selectType,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_selectType",html:_("superboxselect.selectType_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("superboxselect.selectPackage"),description:MODx.expandHelp?"":_("superboxselect.selectPackage_desc"),name:"inopt_selectPackage",id:"inopt_selectPackage",value:this.params.selectPackage||"",anchor:"100%",hidden:!SuperBoxSelect.config.advanced,listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_selectPackage",html:_("superboxselect.selectPackage_desc"),cls:"desc-under",hidden:!SuperBoxSelect.config.advanced},{xtype:"textfield",fieldLabel:_("superboxselect.maxElements"),description:MODx.expandHelp?"":_("superboxselect.maxElements_desc"),name:"inopt_maxElements",id:"inopt_maxElements",value:this.params.maxElements||this.params.maxResources||"",anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_maxElements",html:_("superboxselect.maxElements_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("superboxselect.fieldTpl"),description:MODx.expandHelp?"":_("superboxselect.fieldTpl_desc"),name:"inopt_fieldTpl",id:"inopt_fieldTpl",value:this.params.fieldTpl||"",anchor:"100%",hidden:!SuperBoxSelect.config.advanced,listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_fieldTpl",html:_("superboxselect.fieldTpl_desc"),cls:"desc-under",hidden:!SuperBoxSelect.config.advanced},{xtype:"combo-boolean",fieldLabel:_("required"),description:MODx.expandHelp?"":_("required_desc"),name:"inopt_allowBlank",hiddenName:"inopt_allowBlank",id:"inopt_allowBlank",value:0===this.params.allowBlank||"false"===this.params.allowBlank?0:1,anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_allowBlank",html:_("required_desc"),cls:"desc-under"},{xtype:"combo-boolean",fieldLabel:_("superboxselect.stackItems"),description:MODx.expandHelp?"":_("superboxselect.stackItems_desc"),name:"inopt_stackItems",hiddenName:"inopt_stackItems",id:"inopt_stackItems",value:1===this.params.stackItems||"true"===this.params.stackItems?1:0,anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_stackItems",html:_("superboxselect.stackItems_desc"),cls:"desc-under"},{xtype:"superboxselect-panel-inputoptions-types",params:this.params},{xtype:"numberfield",fieldLabel:_("superboxselect.pageSize"),description:MODx.expandHelp?"":_("superboxselect.pageSize_desc"),name:"inopt_pageSize",id:"inopt_pageSize",value:this.params.pageSize||10,allowNegative:!1,allowDecimals:!1,anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_pageSize",html:_("superboxselect.pageSize_desc"),cls:"desc-under"}],listeners:{afterrender:{fn:this.inputOptionsAfterRender,scope:this}}}),SuperBoxSelect.panel.InputOptions.superclass.constructor.call(this,e)},Ext.extend(SuperBoxSelect.panel.InputOptions,MODx.Panel,{selectType:function(e,t){var o=Ext.getCmp("modx-input-props").getEl().select(".alltypes");o&&o.each(function(e){e.setStyle("height","0")});var n=Ext.getCmp("type_"+t.id);n&&n.getEl().setStyle("height",null)},inputOptionsAfterRender:function(){var e=Ext.getCmp("inopt_selectType").getValue();if(e){var t=Ext.getCmp("type_"+e);t&&t.getEl().setStyle("height",null)}var o=Ext.getCmp("modx-tv-elements");o&&o.itemCt.applyStyles({height:"0",overflow:"hidden"})},markDirty:function(){Ext.getCmp("modx-panel-tv").markDirty()}}),Ext.reg("superboxselect-panel-inputoptions",SuperBoxSelect.panel.InputOptions),SuperBoxSelect.combo.SuperBoxSelectTV=function(e){e=e||{},this.options=e.options,this.params=e.params,this.tvid=this.options.tvid,this.maxElements=this.options.maxElements,Ext.applyIf(e,{addNewDataOnBlur:!1,allowBlank:this.options.allowBlank,anchor:"100%",classField:"cls",ctCls:"superboxselect-tv",displayField:"title",displayFieldTpl:this.options.fieldTpl,fieldLabel:this.options.fieldLabel,listeners:{afterrender:{fn:this.afterrender,scope:this},beforeadditem:{fn:this.beforeadditem,scope:this},additem:{fn:this.additem,scope:this},removeitem:{fn:this.removeitem,scope:this}},minChars:2,mode:"remote",msgTarget:"title",name:"tv"+this.tvid+"[]",pageSize:this.options.pageSize,stackItems:this.options.stackItems,queryDelay:0,store:this.options.store,styleField:"style",tpl:'<tpl for="."><div class="x-combo-list-item">'+this.options.fieldTpl+"</div></tpl>",transform:"superboxselect-tv-"+this.tvid,triggerAction:"all",value:this.options.value,valueField:"id",width:400}),SuperBoxSelect.combo.SuperBoxSelectTV.superclass.constructor.call(this,e)},SuperBoxSelect.combo.SuperBoxSelectTV=Ext.extend(SuperBoxSelect.combo.SuperBoxSelectTV,Ext.ux.form.SuperBoxSelect,{afterrender:function(){if(this.maxElements){var e=Ext.get("tv"+this.tvid+"-caption"),t=_("superboxselect.maxElements_label").replace("{maxElements}",this.maxElements);e.dom.innerHTML=e.dom.innerHTML+' <span class="modx-tv-label-description">('+t+")</span>"}var n=this,o=document.querySelectorAll("#"+this.outerWrapEl.id+" ul")[0];o?(o.setAttribute("data-xcomponentid",this.id),new Sortable(o,{onEnd:function(e){if(e.currentTarget){var t=e.currentTarget.getAttribute("data-xcomponentid"),o=Ext.getCmp(t);o?(n.refreshSorting(o),MODx.fireResourceFormChange()):console.log("Unable to reference xComponentContext.")}}})):console.log("Unable to find select element")},beforeadditem:function(e){if(this.maxElements)return!(e.getCount()>this.maxElements-1)||(MODx.msg.alert(_("error"),_("superboxselect.maxElements_msg")),!1)},additem:function(){MODx.fireResourceFormChange()},removeitem:function(){MODx.fireResourceFormChange()},refreshSorting:function(e){var t,o=e.items.items,n=document.querySelectorAll("#"+e.outerWrapEl.dom.id+" .x-superboxselect-input"),i=function(e){return Array.prototype.slice.call(e.parentElement.children).indexOf(e)},s=function(e,t){for(var o=0;o<t.length;o+=1)if(t[o].value===e)return t[o]},r=function(e,t){var o=i(e.el.dom),n=i(t.el.dom);return o<n?-1:n<o?1:0};o.sort(r),t instanceof Function&&t(),function(e,t,o){var n=t[0].parentElement;if(!n)return console.debug("syncElementsByValue(), Unable to reference list root element.");for(var i=0;i<e.length;i+=1){var r=e[i],l=s(r.value,t),a=t[i];null!==l&&void 0!==a&&n.insertBefore(l,a)}o instanceof Function&&o()}(o,n[0].children),e.value=e.getValue()},getElementComponentContext:function(e){var t=Array.prototype.slice.call(e.classList);return"body"!==e.tagName?null:t.indexOf("x-superboxselect")?e:void getElementComponentContext(e.parentElement)}}),Ext.reg("superboxselect-combo-superboxselectv",SuperBoxSelect.combo.SuperBoxSelectTV),SuperBoxSelect.combo.SuperBoxSelectTVSingle=function(e){e=e||{},this.options=e.options,this.params=e.params,this.tvid=this.options.tvid,Ext.applyIf(e,{allowBlank:this.options.allowBlank,anchor:"100%",ctCls:"superboxselect-tv",displayField:"title",fieldLabel:this.options.fieldLabel,hiddenName:"tv"+this.tvid,minChars:2,mode:"remote",msgTarget:"title",name:"tv"+this.tvid,pageSize:this.options.pageSize,queryDelay:0,store:this.options.store,tpl:'<tpl for="."><div class="x-combo-list-item">'+this.options.fieldTpl+"</div></tpl>",transform:"superboxselect-tv-"+this.tvid,triggerAction:"all",value:this.options.value,valueField:"id",width:400}),SuperBoxSelect.combo.SuperBoxSelectTVSingle.superclass.constructor.call(this,e)},SuperBoxSelect.combo.SuperBoxSelectTVSingle=Ext.extend(SuperBoxSelect.combo.SuperBoxSelectTVSingle,Ext.form.ComboBox),Ext.reg("superboxselect-combo-superboxselectv-single",SuperBoxSelect.combo.SuperBoxSelectTVSingle),SuperBoxSelectTV.Renderer=function(e){return e.length,""};