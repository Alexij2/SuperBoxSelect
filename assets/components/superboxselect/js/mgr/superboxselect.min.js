/*!
 * SuperBoxSelect - Select Resources with a Superboxselect
 * Version: 2.1.0
 * Build date: 2016-08-17
 */

var SuperBoxSelectTV=function(a){a=a||{},SuperBoxSelectTV.superclass.constructor.call(this,a)};Ext.extend(SuperBoxSelectTV,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},jquery:{},form:{}}),Ext.reg("superboxselecttv",SuperBoxSelectTV);var SuperBoxSelect=new SuperBoxSelectTV;SuperBoxSelect.panel.InputOptions=function(a){a=a||{},this.options=a.options,this.params=a.params,Ext.applyIf(a,{layout:"form",autoHeight:!0,cls:"form-with-labels",labelAlign:"top",border:!1,items:[{xtype:"modx-combo",fieldLabel:_("superboxselect.selectType"),description:MODx.expandHelp?"":_("superboxselect.selectType_desc"),name:"inopt_selectType",hiddenName:"inopt_selectType",id:"inopt_selectType",value:this.params.selectType||"resources",anchor:"100%",url:SuperBoxSelect.config.connectorUrl,baseParams:{action:"mgr/selecttypes/getList"},listeners:{select:{fn:this.selectType,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_selectType",html:_("superboxselect.selectType_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("superboxselect.selectPackage"),description:MODx.expandHelp?"":_("superboxselect.selectPackage_desc"),name:"inopt_selectPackage",id:"inopt_selectPackage",value:this.params.selectPackage||"",anchor:"100%",hidden:!SuperBoxSelect.config.advanced,listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_selectPackage",html:_("superboxselect.selectPackage_desc"),cls:"desc-under",hidden:!SuperBoxSelect.config.advanced},{xtype:"textfield",fieldLabel:_("superboxselect.fieldTpl"),description:MODx.expandHelp?"":_("superboxselect.fieldTpl_desc"),name:"inopt_fieldTpl",id:"inopt_fieldTpl",value:this.params.fieldTpl||"",anchor:"100%",hidden:!SuperBoxSelect.config.advanced,listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_fieldTpl",html:_("superboxselect.fieldTpl_desc"),cls:"desc-under",hidden:!SuperBoxSelect.config.advanced},{xtype:"combo-boolean",fieldLabel:_("required"),description:MODx.expandHelp?"":_("required_desc"),name:"inopt_allowBlank",hiddenName:"inopt_allowBlank",id:"inopt_allowBlank",value:0==this.params.allowBlank||"false"==this.params.allowBlank?0:1,anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_allowBlank",html:_("required_desc"),cls:"desc-under"},[{xtype:"superboxselect-panel-inputoptions-resources",params:params},{xtype:"superboxselect-panel-inputoptions-users",params:params}],{xtype:"numberfield",fieldLabel:_("superboxselect.pageSize"),description:MODx.expandHelp?"":_("superboxselect.pageSize_desc"),name:"inopt_pageSize",id:"inopt_pageSize",value:this.params.pageSize||10,allowNegative:!1,allowDecimals:!1,anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_pageSize",html:_("superboxselect.pageSize_desc"),cls:"desc-under"}],listeners:{afterrender:{fn:this.inputOptionsAfterRender,scope:this}}}),SuperBoxSelect.panel.InputOptions.superclass.constructor.call(this,a)},Ext.extend(SuperBoxSelect.panel.InputOptions,MODx.Panel,{selectType:function(a,b){var c=Ext.getCmp("modx-input-props").getEl().select(".alltypes");c&&c.each(function(a){a.setStyle("height","0")});var d=Ext.getCmp("type_"+b.id);d&&d.getEl().setStyle("height",null)},inputOptionsAfterRender:function(){var a=Ext.getCmp("inopt_selectType").getValue();if(a){var b=Ext.getCmp("type_"+a);b&&b.getEl().setStyle("height",null)}var c=Ext.getCmp("modx-tv-elements");c&&c.itemCt.applyStyles({height:"0",overflow:"hidden"})},markDirty:function(){Ext.getCmp("modx-panel-tv").markDirty()}}),Ext.reg("superboxselect-panel-inputoptions",SuperBoxSelect.panel.InputOptions),SuperBoxSelect.panel.InputOptionsResources=function(a){a=a||{},this.options=a.options,this.params=a.params,Ext.applyIf(a,{layout:"fit",id:"type_resources",cls:"alltypes",style:{height:"0",overflow:"hidden"},items:[{xtype:"panel",layout:"form",labelAlign:"top",items:[{xtype:"textfield",fieldLabel:_("resourcelist_parents"),description:MODx.expandHelp?"":_("resourcelist_parents_desc"),name:"inopt_parents",id:"inopt_parents",value:this.params.parents||"",anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_parents",html:_("resourcelist_parents_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("superboxselect.maxResources"),description:MODx.expandHelp?"":_("superboxselect.maxResources_desc"),name:"inopt_maxResources",id:"inopt_maxResources",value:this.params.maxResources||"",anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_maxResources",html:_("superboxselect.maxResources_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("resourcelist_depth"),description:MODx.expandHelp?"":_("resourcelist_depth_desc"),name:"inopt_depth",id:"inopt_depth",value:this.params.depth||10,anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_depth",html:_("resourcelist_depth_desc"),cls:"desc-under"},{xtype:"combo-boolean",fieldLabel:_("resourcelist_limitrelatedcontext"),description:MODx.expandHelp?"":_("resourcelist_limitrelatedcontext_desc"),name:"inopt_limitRelatedContext",hiddenName:"inopt_limitRelatedContext",id:"inopt_limitRelatedContext",value:1==this.params.limitRelatedContext||"true"==this.params.limitRelatedContext?1:0,anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_limitRelatedContext",html:_("resourcelist_limitrelatedcontext_desc"),cls:"desc-under"},{xtype:"textarea",fieldLabel:_("resourcelist_where"),description:MODx.expandHelp?"":_("resourcelist_where_desc"),name:"inopt_where",id:"inopt_where",value:this.params.where||"",anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_where",html:_("resourcelist_where_desc"),cls:"desc-under"}]}]}),SuperBoxSelect.panel.InputOptionsResources.superclass.constructor.call(this,a)},Ext.extend(SuperBoxSelect.panel.InputOptionsResources,MODx.Panel,{markDirty:function(){Ext.getCmp("modx-panel-tv").markDirty()}}),Ext.reg("superboxselect-panel-inputoptions-resources",SuperBoxSelect.panel.InputOptionsResources),SuperBoxSelect.panel.InputOptionsUsers=function(a){a=a||{},this.options=a.options,this.params=a.params,Ext.applyIf(a,{layout:"fit",id:"type_users",cls:"alltypes",style:{height:"0",overflow:"hidden"},items:[{xtype:"panel",layout:"form",labelAlign:"top",items:[{xtype:"textfield",fieldLabel:_("superboxselect.allowedUsergroups"),description:MODx.expandHelp?"":_("rsuperboxselect.allowedUsergroups_desc"),name:"inopt_allowedUsergroups",id:"inopt_allowedUsergroups",value:this.params.allowedUsergroups||"",anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_allowedUsergroups",html:_("superboxselect.allowedUsergroups_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("superboxselect.deniedUsergroups"),description:MODx.expandHelp?"":_("rsuperboxselect.deniedUsergroups_desc"),name:"inopt_deniedUsergroups",id:"inopt_deniedUsergroups",value:this.params.deniedUsergroups||"",anchor:"100%",listeners:{change:{fn:this.markDirty,scope:this}}},{xtype:MODx.expandHelp?"label":"hidden",forId:"inopt_deniedUsergroups",html:_("superboxselect.deniedUsergroups_desc"),cls:"desc-under"}]}]}),SuperBoxSelect.panel.InputOptionsUsers.superclass.constructor.call(this,a)},Ext.extend(SuperBoxSelect.panel.InputOptionsUsers,MODx.Panel,{markDirty:function(){Ext.getCmp("modx-panel-tv").markDirty()}}),Ext.reg("superboxselect-panel-inputoptions-users",SuperBoxSelect.panel.InputOptionsUsers),SuperBoxSelect.combo.SuperBoxSelectTV=function(a){a=a||{},this.options=a.options,this.params=a.params,Ext.applyIf(a,{addNewDataOnBlur:!1,allowBlank:this.options.allowBlank,anchor:"100%",classField:"cls",ctCls:"superboxselect-tv",displayField:"title",displayFieldTpl:this.options.fieldTpl,fieldLabel:this.options.fieldLabel,minChars:2,mode:"remote",msgTarget:"title",name:"tv"+this.options.tvid+"[]",pageSize:this.options.pageSize,queryDelay:0,store:this.options.store,styleField:"style",tpl:'<tpl for="."><div class="x-combo-list-item">'+this.options.fieldTpl+"</div></tpl>",transform:"superboxselect-tv-"+this.options.tvid,triggerAction:"all",value:this.options.value,valueField:"id",width:400,listeners:{afterrender:{fn:this.afterrender,scope:this},beforeadditem:{fn:this.beforeadditem,scope:this},additem:{fn:this.additem,scope:this},removeitem:{fn:this.removeitem,scope:this}}}),SuperBoxSelect.combo.SuperBoxSelectTV.superclass.constructor.call(this,a)},SuperBoxSelect.combo.SuperBoxSelectTV=Ext.extend(SuperBoxSelect.combo.SuperBoxSelectTV,Ext.ux.form.SuperBoxSelect,{afterrender:function(){if(this.options.maxResources){var a=Ext.get("tv"+this.options.tvid+"-caption"),b=_("superboxselect.maxResources_label").replace(/{maxResources}/,this.options.maxResources);a.dom.innerHTML=a.dom.innerHTML+' <span class="modx-tv-label-description">('+b+")</span>"}},beforeadditem:function(a){return this.options.maxResources?a.getCount()>this.options.maxResources-1?(MODx.msg.alert(_("error"),_("superboxselect.maxResources_msg")),!1):!0:void 0},additem:function(){MODx.fireResourceFormChange()},removeitem:function(){MODx.fireResourceFormChange()}}),Ext.reg("superboxselect-combo-superboxselectv",SuperBoxSelect.combo.SuperBoxSelectTV),SuperBoxSelect.Renderer=function(a){return a.length,""};